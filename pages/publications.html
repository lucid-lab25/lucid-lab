<section id="publications">
  <div class="pubs-container">
    <h2>Publications</h2>
    <div id="pubs-root"></div>
  </div>
  <script>
    // This script defines a render hook for main.js
    window.__renderPublications = async function () {
      const root = document.getElementById("pubs-root");
      if (!root) return;
      try {
        const resp = await fetch("data/publications.json");
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        const highlight = (name) =>
          name === data.highlightAuthor
            ? `<span class="author-highlight">${name}</span>`
            : name;

        // Build markup
        const yearBlocks = (data.years || [])
          .map((y) => {
            const items = (y.items || [])
              .map((p) => {
                const authors = (p.authors || [])
                  .map((a) => highlight(a))
                  .join(", ");
                const links = (p.links || [])
                  .map((l) => {
                    if (!l || !l.label) return "";
                    const href = l.href || "#";
                    const cls = l.alt ? "pub-badge alt" : "pub-badge";
                    return `<a class="${cls}" href="${href}">${l.label}</a>`;
                  })
                  .join("\n");
                return `
                  <article class="pub-item">
                    <div class="pub-venue">${p.venue || ""}</div>
                    <h4 class="pub-title">${p.title || ""}</h4>
                    <p class="pub-authors">${authors}</p>
                    <div class="pub-links">${links}</div>
                  </article>`;
              })
              .join("\n");

            return `
              <div class="pub-year reveal">
                <h3 class="pub-year-title">${y.year}</h3>
                <div class="pub-grid">${items}</div>
              </div>`;
          })
          .join("\n");

        root.innerHTML = yearBlocks;
        // Re-run reveal to apply animations to new nodes
        if (typeof window.reveal === "function") {
          window.reveal();
        }
      } catch (e) {
        console.error("Failed to render publications:", e);
        root.innerHTML = "<p style=\"color:#999\">Failed to load publications.</p>";
      }
    };
  </script>
</section>
